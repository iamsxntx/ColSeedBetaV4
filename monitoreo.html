document.addEventListener("DOMContentLoaded", function() {
    console.log("Script cargado correctamente.");
});

function monitorearCultivo() {
    let resultados = document.getElementById("monitoreoResultados");
    resultados.innerHTML = "<p>ðŸ”„ Monitoreo en proceso...</p>";

    fetch("http://192.168.0.33/data") // âš  Cambia esta IP por la de tu ESP32
        .then(response => response.json())
        .then(data => {
            const nivelLuz = convertirLuxANivel(data.luz);
            resultados.innerHTML = construir_respuesta_html(data.temperatura, data.humedad, nivelLuz);
        })
        .catch(error => {
            resultados.innerHTML = "<p style='color:red;'>âš  Error al obtener datos del sensor.</p>";
            console.error("Error al obtener datos:", error);
        });
}

function convertirLuxANivel(lx) {
    if (lx < 500) return "Baja";
    if (lx < 2500) return "Media";
    return "Alta";
}

function construir_respuesta_html(temp, hum, luz) {
    return `
        <div class="container text-center">
            ${crear_card("ðŸŒ¡ Temperatura", temp, "Â°C", "temp")}
            ${crear_card("ðŸ’§ Humedad", hum, "%", "hum")}
            ${crear_card("â˜€ Luz", luz, "", "luz")}
        </div>
    `;
}

function crear_card(titulo, valor, unidad, clase) {
    return `
        <div class='card ${clase} p-3 mb-3 shadow' style="border-left: 5px solid ${getColor(clase)};">
            <h2>${titulo}</h2>
            <p>${isNaN(valor) ? "Error al leer sensor" : valor + " " + unidad}</p>
        </div>
    `;
}

function getColor(clase) {
    switch (clase) {
        case "temp": return "#ff5722"; // Naranja para temperatura
        case "hum": return "#03a9f4";  // Azul para humedad
        case "luz": return "#ffeb3b";  // Amarillo para luz
        default: return "#ccc";
    }
}
